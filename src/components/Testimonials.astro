---
// Testimonials.astro - Seção de depoimentos com carousel responsivo
---

<section class="section bg-gray-50" id="depoimentos">
  <div class="container">
    <div class="text-center mb-12">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">
        Depoimentos Reais
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Veja os resultados de quem já transformou o corpo com os treinos do Charles
      </p>
    </div>
    
    <!-- Testimonials Carousel -->
    <div class="testimonials-carousel" data-carousel>
      <div class="testimonials-wrapper" data-carousel-track>
        
        <!-- Testimonial 1 - Emagrecimento -->
        <div class="testimonial-card" data-testimonial>
          <div class="testimonial-header">
            <div class="testimonial-photo">
              <div class="testimonial-avatar">
                <img 
                  src="/images/testimonial-maria.jpg" 
                  alt="Maria Silva - Cliente do Charles Personal"
                  class="testimonial-image"
                  loading="lazy"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <div class="testimonial-fallback">
                  <span>MS</span>
                </div>
              </div>
              <div class="credibility-badge">
                <span class="badge-icon">✓</span>
                <span class="badge-text">Cliente Real</span>
              </div>
            </div>
            <div class="testimonial-info">
              <h3 class="testimonial-name">Maria Silva</h3>
              <p class="testimonial-achievement">Emagreceu 15kg em 4 meses</p>
              <p class="testimonial-age">32 anos, Vitória - ES</p>
              <p class="testimonial-period">Cliente desde março/2024</p>
            </div>
          </div>
          
          <div class="testimonial-content">
            <div class="testimonial-quote">
              <p>
                "Sempre lutei contra a balança, mas com os treinos personalizados do Charles no MFit consegui finalmente emagrecer de forma saudável. Perdi 15kg em 4 meses e o melhor: mantive o resultado! O acompanhamento é incrível, ele sempre ajusta os exercícios conforme minha evolução."
              </p>
            </div>
            
            <div class="testimonial-details">
              <div class="detail-item">
                <span class="detail-label">Problema Inicial:</span>
                <span class="detail-value">Sobrepeso e dietas sem resultado</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Solução:</span>
                <span class="detail-value">Treinos personalizados + MFit</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Resultado:</span>
                <span class="detail-value">15kg perdidos mantidos</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tempo:</span>
                <span class="detail-value">4 meses</span>
              </div>
            </div>
            
            <div class="testimonial-rating">
              <span class="stars">★★★★★</span>
              <span class="rating-text">Excelente - Recomenda 100%</span>
            </div>
          </div>
        </div>
        
        <!-- Testimonial 2 - Ganho de Massa -->
        <div class="testimonial-card" data-testimonial>
          <div class="testimonial-header">
            <div class="testimonial-photo">
              <div class="testimonial-avatar">
                <img 
                  src="/images/testimonial-joao.jpg" 
                  alt="João Santos - Cliente do Charles Personal"
                  class="testimonial-image"
                  loading="lazy"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <div class="testimonial-fallback">
                  <span>JS</span>
                </div>
              </div>
              <div class="credibility-badge">
                <span class="badge-icon">✓</span>
                <span class="badge-text">Cliente Real</span>
              </div>
            </div>
            <div class="testimonial-info">
              <h3 class="testimonial-name">João Santos</h3>
              <p class="testimonial-achievement">Ganhou 8kg de massa muscular</p>
              <p class="testimonial-age">28 anos, Vila Velha - ES</p>
              <p class="testimonial-period">Cliente desde janeiro/2024</p>
            </div>
          </div>
          
          <div class="testimonial-content">
            <div class="testimonial-quote">
              <p>
                "Sempre fui magro e tinha dificuldade para ganhar peso. Com o método do Charles consegui ganhar 8kg de massa magra em 6 meses. Os treinos são desafiadores mas progressivos, e a orientação nutricional fez toda a diferença. Hoje me sinto muito mais forte e confiante!"
              </p>
            </div>
            
            <div class="testimonial-details">
              <div class="detail-item">
                <span class="detail-label">Problema Inicial:</span>
                <span class="detail-value">Dificuldade para ganhar peso</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Solução:</span>
                <span class="detail-value">Treinos progressivos + nutrição</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Resultado:</span>
                <span class="detail-value">8kg de massa magra</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tempo:</span>
                <span class="detail-value">6 meses</span>
              </div>
            </div>
            
            <div class="testimonial-rating">
              <span class="stars">★★★★★</span>
              <span class="rating-text">Excelente - Recomenda 100%</span>
            </div>
          </div>
        </div>
        
        <!-- Testimonial 3 - Saúde e Bem-estar -->
        <div class="testimonial-card" data-testimonial>
          <div class="testimonial-header">
            <div class="testimonial-photo">
              <div class="testimonial-avatar">
                <img 
                  src="/images/testimonial-ana.jpg" 
                  alt="Ana Costa - Cliente do Charles Personal"
                  class="testimonial-image"
                  loading="lazy"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <div class="testimonial-fallback">
                  <span>AC</span>
                </div>
              </div>
              <div class="credibility-badge">
                <span class="badge-icon">✓</span>
                <span class="badge-text">Cliente Real</span>
              </div>
            </div>
            <div class="testimonial-info">
              <h3 class="testimonial-name">Ana Costa</h3>
              <p class="testimonial-achievement">Melhorou disposição e qualidade de vida</p>
              <p class="testimonial-age">45 anos, Cariacica - ES</p>
              <p class="testimonial-period">Cliente desde agosto/2023</p>
            </div>
          </div>
          
          <div class="testimonial-content">
            <div class="testimonial-quote">
              <p>
                "Procurei o Charles não só para emagrecer, mas para melhorar minha qualidade de vida. Com 45 anos, estava sempre cansada e sem disposição. Hoje, após 8 meses de treinos, me sinto renovada! Tenho muito mais energia para trabalhar e cuidar da família."
              </p>
            </div>
            
            <div class="testimonial-details">
              <div class="detail-item">
                <span class="detail-label">Problema Inicial:</span>
                <span class="detail-value">Cansaço e falta de disposição</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Solução:</span>
                <span class="detail-value">Exercícios adaptados à idade</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Resultado:</span>
                <span class="detail-value">Mais energia e vitalidade</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tempo:</span>
                <span class="detail-value">8 meses</span>
              </div>
            </div>
            
            <div class="testimonial-rating">
              <span class="stars">★★★★★</span>
              <span class="rating-text">Excelente - Recomenda 100%</span>
            </div>
          </div>
        </div>
        
        <!-- Testimonial 4 - Experiência MFit -->
        <div class="testimonial-card" data-testimonial>
          <div class="testimonial-header">
            <div class="testimonial-photo">
              <div class="testimonial-avatar">
                <img 
                  src="/images/testimonial-carlos.jpg" 
                  alt="Carlos Oliveira - Cliente do Charles Personal"
                  class="testimonial-image"
                  loading="lazy"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <div class="testimonial-fallback">
                  <span>CO</span>
                </div>
              </div>
              <div class="credibility-badge">
                <span class="badge-icon">✓</span>
                <span class="badge-text">Cliente Real</span>
              </div>
            </div>
            <div class="testimonial-info">
              <h3 class="testimonial-name">Carlos Oliveira</h3>
              <p class="testimonial-achievement">Aderiu ao exercício através do MFit</p>
              <p class="testimonial-age">35 anos, Serra - ES</p>
              <p class="testimonial-period">Cliente desde dezembro/2023</p>
            </div>
          </div>
          
          <div class="testimonial-content">
            <div class="testimonial-quote">
              <p>
                "O aplicativo MFit foi um divisor de águas para mim. Como viajo muito a trabalho, ter os treinos no celular com o acompanhamento do Charles mudou completamente minha rotina. Consigo treinar em qualquer lugar e os resultados são acompanhados de perto. Praticidade total!"
              </p>
            </div>
            
            <div class="testimonial-details">
              <div class="detail-item">
                <span class="detail-label">Problema Inicial:</span>
                <span class="detail-value">Rotina de viagens constantes</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Solução:</span>
                <span class="detail-value">App MFit + acompanhamento</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Resultado:</span>
                <span class="detail-value">Consistência e resultados</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tempo:</span>
                <span class="detail-value">1 ano</span>
              </div>
            </div>
            
            <div class="testimonial-rating">
              <span class="stars">★★★★★</span>
              <span class="rating-text">Excelente - Recomenda 100%</span>
            </div>
          </div>
        </div>
        
        <!-- Testimonial 5 - Transformação Completa -->
        <div class="testimonial-card" data-testimonial>
          <div class="testimonial-header">
            <div class="testimonial-photo">
              <div class="testimonial-avatar">
                <img 
                  src="/images/testimonial-lucia.jpg" 
                  alt="Lúcia Ferreira - Cliente do Charles Personal"
                  class="testimonial-image"
                  loading="lazy"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'"
                />
                <div class="testimonial-fallback">
                  <span>LF</span>
                </div>
              </div>
              <div class="credibility-badge">
                <span class="badge-icon">✓</span>
                <span class="badge-text">Cliente Real</span>
              </div>
            </div>
            <div class="testimonial-info">
              <h3 class="testimonial-name">Lúcia Ferreira</h3>
              <p class="testimonial-achievement">Transformação completa em 1 ano</p>
              <p class="testimonial-age">38 anos, Vitória - ES</p>
              <p class="testimonial-period">Cliente desde junho/2023</p>
            </div>
          </div>
          
          <div class="testimonial-content">
            <div class="testimonial-quote">
              <p>
                "Um ano atrás eu estava 20kg acima do peso, sedentária e com autoestima baixa. O Charles não só me ajudou a emagrecer, mas transformou completamente minha relação com o exercício. Hoje sou uma pessoa mais confiante, saudável e feliz. Gratidão eterna!"
              </p>
            </div>
            
            <div class="testimonial-details">
              <div class="detail-item">
                <span class="detail-label">Problema Inicial:</span>
                <span class="detail-value">Sobrepeso e baixa autoestima</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Solução:</span>
                <span class="detail-value">Transformação completa</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Resultado:</span>
                <span class="detail-value">20kg perdidos + autoestima</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tempo:</span>
                <span class="detail-value">1 ano</span>
              </div>
            </div>
            
            <div class="testimonial-rating">
              <span class="stars">★★★★★</span>
              <span class="rating-text">Excelente - Recomenda 100%</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button class="carousel-btn carousel-btn-prev" data-carousel-prev aria-label="Depoimento anterior">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <button class="carousel-btn carousel-btn-next" data-carousel-next aria-label="Próximo depoimento">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      
      <!-- Dots Navigation -->
      <div class="carousel-dots" data-carousel-dots>
        <button class="carousel-dot active" data-dot="0" aria-label="Ir para depoimento 1"></button>
        <button class="carousel-dot" data-dot="1" aria-label="Ir para depoimento 2"></button>
        <button class="carousel-dot" data-dot="2" aria-label="Ir para depoimento 3"></button>
        <button class="carousel-dot" data-dot="3" aria-label="Ir para depoimento 4"></button>
        <button class="carousel-dot" data-dot="4" aria-label="Ir para depoimento 5"></button>
      </div>
    </div>
    
    <!-- Social Proof Stats -->
    <div class="social-proof-stats">
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-number">150+</span>
          <span class="stat-label">Clientes Transformados</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">95%</span>
          <span class="stat-label">Taxa de Sucesso</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">4.9/5</span>
          <span class="stat-label">Avaliação Média</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">3+</span>
          <span class="stat-label">Anos de Experiência</span>
        </div>
      </div>
    </div>
    
    <!-- CTA após depoimentos -->
    <div class="text-center mt-12">
      <p class="text-lg text-gray-600 mb-6">
        Quer ser o próximo a conquistar seus objetivos?
      </p>
      <a 
        href="#contato" 
        class="btn btn-primary btn-lg"
        data-cta="testimonials-to-contact"
      >
        Começar Minha Transformação
      </a>
    </div>
  </div>
</section>

<style>
/* ==========================================================================
   TESTIMONIALS CAROUSEL STYLES
   ========================================================================== */

.testimonials-carousel {
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-xl);
}

.testimonials-wrapper {
  display: flex;
  transition: transform 0.5s ease-in-out;
  will-change: transform;
}

.testimonial-card {
  flex: 0 0 100%;
  background: var(--color-white);
  border-radius: var(--radius-xl);
  padding: var(--spacing-8);
  margin: 0 var(--spacing-4);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--color-gray-100);
  position: relative;
  overflow: hidden;
}

.testimonial-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
}

/* Testimonial Header */
.testimonial-header {
  display: flex;
  align-items: flex-start;
  margin-bottom: var(--spacing-6);
  gap: var(--spacing-4);
}

.testimonial-photo {
  flex-shrink: 0;
  position: relative;
}

.testimonial-avatar {
  position: relative;
  width: 80px;
  height: 80px;
}

.testimonial-image {
  width: 80px;
  height: 80px;
  border-radius: var(--radius-full);
  object-fit: cover;
  border: 3px solid var(--color-primary);
  transition: opacity var(--transition-normal);
}

.testimonial-fallback {
  position: absolute;
  top: 0;
  left: 0;
  width: 80px;
  height: 80px;
  border-radius: var(--radius-full);
  background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
  display: none;
  align-items: center;
  justify-content: center;
  color: var(--color-white);
  font-weight: var(--font-weight-bold);
  font-size: var(--font-size-xl);
  border: 3px solid var(--color-primary);
}

.credibility-badge {
  position: absolute;
  bottom: -5px;
  right: -5px;
  background: var(--color-success);
  color: var(--color-white);
  padding: var(--spacing-1) var(--spacing-2);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  display: flex;
  align-items: center;
  gap: var(--spacing-1);
  box-shadow: var(--shadow-sm);
}

.badge-icon {
  font-size: var(--font-size-xs);
}

.testimonial-info {
  flex: 1;
}

.testimonial-name {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-gray-900);
  margin-bottom: var(--spacing-1);
}

.testimonial-achievement {
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  color: var(--color-secondary);
  margin-bottom: var(--spacing-1);
}

.testimonial-age {
  font-size: var(--font-size-sm);
  color: var(--color-gray-600);
  margin-bottom: var(--spacing-1);
}

.testimonial-period {
  font-size: var(--font-size-xs);
  color: var(--color-gray-500);
  font-style: italic;
}

/* Testimonial Content */
.testimonial-quote {
  margin-bottom: var(--spacing-6);
}

.testimonial-quote p {
  font-size: var(--font-size-lg);
  line-height: var(--line-height-relaxed);
  color: var(--color-gray-700);
  font-style: italic;
  position: relative;
  padding: 0 var(--spacing-4);
}

.testimonial-quote p::before,
.testimonial-quote p::after {
  font-size: 3rem;
  color: var(--color-primary);
  position: absolute;
  font-family: serif;
  opacity: 0.3;
  line-height: 1;
}

.testimonial-quote p::before {
  content: '"';
  left: -5px;
  top: -15px;
}

.testimonial-quote p::after {
  content: '"';
  right: -5px;
  bottom: -25px;
}

/* Testimonial Details */
.testimonial-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: var(--spacing-3);
  margin-bottom: var(--spacing-6);
  padding: var(--spacing-4);
  background: var(--color-gray-50);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--color-primary);
}

.detail-item {
  display: flex;
  flex-direction: column;
}

.detail-label {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  color: var(--color-gray-600);
  margin-bottom: var(--spacing-1);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.detail-value {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-gray-900);
}

/* Testimonial Rating */
.testimonial-rating {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-2);
  padding: var(--spacing-3);
  background: var(--color-gray-50);
  border-radius: var(--radius-md);
}

.stars {
  color: var(--color-accent);
  font-size: var(--font-size-xl);
}

.rating-text {
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-semibold);
  color: var(--color-gray-700);
}

/* Social Proof Stats */
.social-proof-stats {
  margin: var(--spacing-12) 0;
  padding: var(--spacing-8);
  background: var(--color-white);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--spacing-6);
}

.stat-item {
  text-align: center;
  padding: var(--spacing-4);
}

.stat-number {
  display: block;
  font-size: 2.5rem;
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--spacing-2);
}

.stat-label {
  font-size: var(--font-size-base);
  color: var(--color-gray-600);
  font-weight: var(--font-weight-medium);
}

/* Carousel Navigation */
.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: var(--color-white);
  border: 2px solid var(--color-gray-200);
  border-radius: var(--radius-full);
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all var(--transition-fast);
  z-index: 2;
  color: var(--color-gray-600);
  box-shadow: var(--shadow-md);
}

.carousel-btn:hover {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: var(--color-white);
  transform: translateY(-50%) scale(1.1);
  box-shadow: var(--shadow-lg);
}

.carousel-btn-prev {
  left: var(--spacing-4);
}

.carousel-btn-next {
  right: var(--spacing-4);
}

/* Carousel Dots */
.carousel-dots {
  display: flex;
  justify-content: center;
  gap: var(--spacing-3);
  margin-top: var(--spacing-8);
}

.carousel-dot {
  width: 12px;
  height: 12px;
  border-radius: var(--radius-full);
  border: none;
  background: var(--color-gray-300);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.carousel-dot:hover,
.carousel-dot.active {
  background: var(--color-primary);
  transform: scale(1.2);
}

/* Responsive Design */
@media (min-width: 768px) {
  .testimonial-card {
    flex: 0 0 calc(50% - var(--spacing-4));
  }
  
  .testimonials-wrapper {
    margin: 0 calc(-1 * var(--spacing-4));
  }
  
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (min-width: 1024px) {
  .testimonial-card {
    flex: 0 0 calc(33.333% - var(--spacing-4));
  }
  
  .testimonial-details {
    grid-template-columns: 1fr;
  }
  
  .testimonial-header {
    align-items: center;
  }
}

/* Touch Gestures Support */
@media (max-width: 767px) {
  .testimonials-carousel {
    touch-action: pan-x;
  }
  
  .carousel-btn {
    display: none;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .stat-number {
    font-size: 2rem;
  }
}

@media (max-width: 480px) {
  .testimonial-card {
    padding: var(--spacing-6);
    margin: 0 var(--spacing-2);
  }
  
  .testimonial-header {
    flex-direction: column;
    text-align: center;
    gap: var(--spacing-3);
  }
  
  .testimonial-details {
    grid-template-columns: 1fr;
    gap: var(--spacing-2);
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
    gap: var(--spacing-4);
  }
}

/* Loading States */
.testimonial-image {
  background: var(--color-gray-200);
  transition: opacity var(--transition-normal);
}

.testimonial-image[loading="lazy"] {
  opacity: 0;
}

.testimonial-image[loading="lazy"].loaded {
  opacity: 1;
}

/* Animation for auto-play */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.testimonial-card.animate-in {
  animation: slideIn 0.5s ease-out;
}

/* Accessibility improvements */
@media (prefers-reduced-motion: reduce) {
  .testimonials-wrapper {
    transition: none;
  }
  
  .testimonial-card.animate-in {
    animation: none;
  }
  
  .carousel-btn {
    transition: none;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .testimonial-card {
    border: 2px solid var(--color-gray-400);
  }
  
  .credibility-badge {
    border: 1px solid var(--color-white);
  }
}
</style>

<script>
// Testimonials Carousel JavaScript
(function() {
  'use strict';
  
  class TestimonialsCarousel {
    carousel: HTMLElement;
    track: HTMLElement;
    testimonials: NodeListOf<HTMLElement>;
    prevBtn: HTMLElement | null;
    nextBtn: HTMLElement | null;
    dots: NodeListOf<HTMLButtonElement>;
    currentIndex: number;
    isAutoPlay: boolean;
    autoPlayInterval: ReturnType<typeof setInterval> | null;
    touchStartX: number;
    touchEndX: number;

    constructor(element: HTMLElement) {
      this.carousel = element;
      this.track = element.querySelector('[data-carousel-track]') as HTMLElement;
      this.testimonials = element.querySelectorAll('[data-testimonial]') as NodeListOf<HTMLElement>;
      this.prevBtn = element.querySelector('[data-carousel-prev]');
      this.nextBtn = element.querySelector('[data-carousel-next]');
      this.dots = element.querySelectorAll('[data-dot]') as NodeListOf<HTMLButtonElement>;
      
      this.currentIndex = 0;
      this.isAutoPlay = true;
      this.autoPlayInterval = null;
      this.touchStartX = 0;
      this.touchEndX = 0;
      
      this.init();
    }
    
    init() {
      this.setupEventListeners();
      this.updateCarousel();
      this.startAutoPlay();
      this.setupImageLoading();
    }
    
    setupEventListeners() {
      // Navigation buttons
      if (this.prevBtn) {
        this.prevBtn.addEventListener('click', () => this.goToPrev());
      }
      if (this.nextBtn) {
        this.nextBtn.addEventListener('click', () => this.goToNext());
      }
      
      // Dots navigation
      this.dots.forEach((dot: HTMLButtonElement, index: number) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });
      
      // Touch events for mobile
      this.carousel.addEventListener('touchstart', (e: TouchEvent) => this.handleTouchStart(e));
      this.carousel.addEventListener('touchend', (e: TouchEvent) => this.handleTouchEnd(e));
      
      // Pause on hover
      this.carousel.addEventListener('mouseenter', () => this.pauseAutoPlay());
      this.carousel.addEventListener('mouseleave', () => this.startAutoPlay());
      
      // Pause on focus
      this.carousel.addEventListener('focusin', () => this.pauseAutoPlay());
      this.carousel.addEventListener('focusout', () => this.startAutoPlay());
      
      // Keyboard navigation
      this.carousel.addEventListener('keydown', (e: KeyboardEvent) => this.handleKeydown(e));
    }
    
    setupImageLoading() {
      const images = this.carousel.querySelectorAll('img[loading="lazy"]');
      images.forEach((img) => {
        const image = img as HTMLImageElement;
        image.addEventListener('load', () => {
          image.classList.add('loaded');
        });
        
        // Handle image loading errors
        image.addEventListener('error', () => {
          const fallback = image.nextElementSibling as HTMLElement | null;
          if (fallback && fallback.classList.contains('testimonial-fallback')) {
            image.style.display = 'none';
            fallback.style.display = 'flex';
          }
        });
      });
    }
    
    updateCarousel() {
      const slideWidth = this.getSlideWidth();
      const offset = -this.currentIndex * slideWidth;
      
      this.track.style.transform = `translateX(${offset}%)`;
      
      // Update dots
      this.dots.forEach((dot: HTMLButtonElement, index: number) => {
        dot.classList.toggle('active', index === this.currentIndex);
      });
      
      // Add animation class
      const currentSlide = this.testimonials[this.currentIndex];
      if (currentSlide) {
        currentSlide.classList.add('animate-in');
        
        // Remove animation class after animation
        setTimeout(() => {
          currentSlide.classList.remove('animate-in');
        }, 500);
      }
    }
    
    getSlideWidth() {
      const viewportWidth = window.innerWidth;
      if (viewportWidth >= 1024) {
        return 100 / 3; // 3 slides per view
      } else if (viewportWidth >= 768) {
        return 50; // 2 slides per view
      } else {
        return 100; // 1 slide per view
      }
    }
    
    goToPrev() {
      this.currentIndex = this.currentIndex > 0 
        ? this.currentIndex - 1 
        : this.testimonials.length - 1;
      this.updateCarousel();
    }
    
    goToNext() {
      this.currentIndex = this.currentIndex < this.testimonials.length - 1 
        ? this.currentIndex + 1 
        : 0;
      this.updateCarousel();
    }
    
    goToSlide(index: number) {
      this.currentIndex = index;
      this.updateCarousel();
    }
    
    startAutoPlay() {
      if (!this.isAutoPlay) return;
      
      this.autoPlayInterval = setInterval(() => {
        this.goToNext();
      }, 5000); // 5 seconds
    }
    
    pauseAutoPlay() {
      if (this.autoPlayInterval) {
        clearInterval(this.autoPlayInterval);
        this.autoPlayInterval = null;
      }
    }
    
    handleTouchStart(e: TouchEvent) {
      this.touchStartX = e.changedTouches[0].screenX;
    }
    
    handleTouchEnd(e: TouchEvent) {
      this.touchEndX = e.changedTouches[0].screenX;
      this.handleSwipe();
    }
    
    handleSwipe() {
      const swipeThreshold = 50;
      const swipeDistance = this.touchStartX - this.touchEndX;
      
      if (Math.abs(swipeDistance) > swipeThreshold) {
        if (swipeDistance > 0) {
          this.goToNext(); // Swipe left
        } else {
          this.goToPrev(); // Swipe right
        }
      }
    }
    
    handleKeydown(e: KeyboardEvent) {
      switch (e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          this.goToPrev();
          break;
        case 'ArrowRight':
          e.preventDefault();
          this.goToNext();
          break;
      }
    }
  }

  // Extend HTMLElement to allow _carouselInstance property
  interface CarouselHTMLElement extends HTMLElement {
    _carouselInstance?: TestimonialsCarousel;
  }

  // Initialize carousel when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.querySelector('[data-carousel]') as CarouselHTMLElement | null;
    if (carousel) {
      const instance = new TestimonialsCarousel(carousel);
      // Store instance for potential future access
      carousel._carouselInstance = instance;
    }
  });

  // Handle resize events
  window.addEventListener('resize', () => {
    const carousel = document.querySelector('[data-carousel]') as CarouselHTMLElement | null;
    if (carousel && carousel._carouselInstance) {
      carousel._carouselInstance.updateCarousel();
    }
  });
})();
</script>
