---
// FormSection.astro - Formulário de captura de leads qualificados
---

<section class="form-section section" id="form">
  <div class="container">
    <div class="form-section__content">
      <!-- Header -->
      <div class="form-section__header text-center mb-12">
        <div class="form-section__badge">
          <svg class="form-section__badge-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 12l2 2 4-4"></path>
            <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
            <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
          </svg>
          <span>Avaliação Gratuita</span>
        </div>
        
        <h2 class="form-section__title">
          Transforme Seu Corpo com um 
          <span class="form-section__highlight">Plano Personalizado</span>
        </h2>
        
        <p class="form-section__subtitle">
          Receba gratuitamente uma avaliação completa e seu primeiro treino personalizado. 
          <strong>Sem compromisso, sem pegadinhas.</strong>
        </p>
      </div>
      
      <!-- Form Container -->
      <div class="form-section__container">
        <div class="form-section__grid grid grid-2">
          <!-- Benefits Side -->
          <div class="form-section__benefits">
            <h3 class="form-section__benefits-title">
              O que você vai receber <strong>grátis:</strong>
            </h3>
            
            <ul class="form-section__benefits-list">
              <li class="form-section__benefit">
                <svg class="form-section__benefit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 12l2 2 4-4"></path>
                  <circle cx="12" cy="12" r="10"></circle>
                </svg>
                <div>
                  <strong>Avaliação Física Completa</strong>
                  <span>Análise detalhada do seu condicionamento atual</span>
                </div>
              </li>
              
              <li class="form-section__benefit">
                <svg class="form-section__benefit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 12l2 2 4-4"></path>
                  <circle cx="12" cy="12" r="10"></circle>
                </svg>
                <div>
                  <strong>Plano de Treino Personalizado</strong>
                  <span>Exercícios específicos para seu objetivo</span>
                </div>
              </li>
              
              <li class="form-section__benefit">
                <svg class="form-section__benefit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 12l2 2 4-4"></path>
                  <circle cx="12" cy="12" r="10"></circle>
                </svg>
                <div>
                  <strong>7 Dias Grátis no MFit</strong>
                  <span>Acesso completo ao app com seus treinos</span>
                </div>
              </li>
              
              <li class="form-section__benefit">
                <svg class="form-section__benefit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 12l2 2 4-4"></path>
                  <circle cx="12" cy="12" r="10"></circle>
                </svg>
                <div>
                  <strong>Suporte Direto via WhatsApp</strong>
                  <span>Tire suas dúvidas diretamente comigo</span>
                </div>
              </li>
            </ul>
            
            <!-- Social Proof -->
            <div class="form-section__social-proof">
              <div class="form-section__stats">
                <div class="form-section__stat">
                  <span class="form-section__stat-number">500+</span>
                  <span class="form-section__stat-label">Clientes Transformados</span>
                </div>
                <div class="form-section__stat">
                  <span class="form-section__stat-number">5.0</span>
                  <span class="form-section__stat-label">Avaliação Média</span>
                </div>
              </div>
              
              <div class="form-section__guarantee">
                <svg class="form-section__guarantee-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                  <path d="M9 12l2 2 4-4"></path>
                </svg>
                <div>
                  <strong>100% Gratuito</strong>
                  <span>Sem cartão de crédito, sem pegadinhas</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Form Side -->
          <div class="form-section__form-container">
            <form 
              class="form-section__form" 
              id="leadForm"
              action="https://formspree.io/f/mwpbljdn"
              method="POST"
              novalidate
            >
              <!-- Hidden fields for tracking -->
              <input type="hidden" name="_next" value="https://charlespersonal.fit/obrigado" />
              <input type="hidden" name="_subject" value="Novo Lead - Charles Personal" />
              <input type="hidden" name="_cc" value="charleston.personal@gmail.com" />
              
              <!-- Nome -->
              <div class="form-section__field">
                <label for="nome" class="form-section__label">
                  Nome Completo *
                </label>
                <input 
                  type="text" 
                  id="nome"
                  name="nome"
                  class="form-section__input"
                  placeholder="Digite seu nome completo"
                  required
                  autocomplete="name"
                  aria-describedby="nome-error"
                />
                <span class="form-section__error" id="nome-error" role="alert"></span>
              </div>
              
              <!-- Email -->
              <div class="form-section__field">
                <label for="email" class="form-section__label">
                  E-mail *
                </label>
                <input 
                  type="email" 
                  id="email"
                  name="email"
                  class="form-section__input"
                  placeholder="seuemail@exemplo.com"
                  required
                  autocomplete="email"
                  aria-describedby="email-error"
                />
                <span class="form-section__error" id="email-error" role="alert"></span>
              </div>
              
              <!-- Celular -->
              <div class="form-section__field">
                <label for="celular" class="form-section__label">
                  Celular (WhatsApp) *
                </label>
                <input 
                  type="tel" 
                  id="celular"
                  name="celular"
                  class="form-section__input"
                  placeholder="(27) 99999-9999"
                  required
                  autocomplete="tel"
                  aria-describedby="celular-error"
                />
                <span class="form-section__error" id="celular-error" role="alert"></span>
              </div>
              
              <!-- Objetivo -->
              <div class="form-section__field">
                <label for="objetivo" class="form-section__label">
                  Qual seu principal objetivo?
                </label>
                <select 
                  id="objetivo"
                  name="objetivo"
                  class="form-section__select"
                  aria-describedby="objetivo-help"
                >
                  <option value="">Selecione seu objetivo</option>
                  <option value="emagrecimento">Emagrecimento</option>
                  <option value="ganho-muscular">Ganho de Massa Muscular</option>
                  <option value="saude-geral">Saúde Geral / Condicionamento</option>
                  <option value="reabilitacao">Reabilitação / Fisioterapia</option>
                  <option value="outro">Outro</option>
                </select>
                <span class="form-section__help" id="objetivo-help">
                  Opcional - nos ajuda a personalizar ainda mais seu treino
                </span>
              </div>
              
              <!-- Privacy Notice -->
              <div class="form-section__privacy">
                <label class="form-section__checkbox-container">
                  <input 
                    type="checkbox" 
                    id="privacy"
                    name="privacy_consent"
                    required
                    class="form-section__checkbox"
                  />
                  <span class="form-section__checkmark"></span>
                  <span class="form-section__checkbox-text">
                    Concordo em receber informações sobre treinos e dicas de saúde por email e WhatsApp. 
                    <a href="/privacidade" target="_blank" class="form-section__link">
                      Política de Privacidade
                    </a>
                  </span>
                </label>
                <span class="form-section__error" id="privacy-error" role="alert"></span>
              </div>
              
              <!-- Submit Button -->
              <button 
                type="submit" 
                class="form-section__submit btn btn-accent btn-lg w-full"
                data-cta="lead-form"
                id="submitBtn"
              >
                <span class="form-section__submit-text">
                  <svg class="form-section__submit-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 12l2 2 4-4"></path>
                    <circle cx="12" cy="12" r="10"></circle>
                  </svg>
                  Quero Meu Plano Personalizado
                </span>
                <span class="form-section__submit-loading" style="display: none;">
                  <svg class="form-section__spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 6v6l4 2"></path>
                  </svg>
                  Enviando...
                </span>
              </button>
              
              <!-- Security Note -->
              <div class="form-section__security">
                <svg class="form-section__security-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <circle cx="12" cy="16" r="1"></circle>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span>Seus dados estão 100% seguros e protegidos</span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  /* ==========================================================================
     FORM SECTION STYLES
     ========================================================================== */
  
  .form-section {
    background: linear-gradient(135deg, var(--color-gray-50) 0%, var(--color-white) 100%);
    position: relative;
    overflow: hidden;
  }
  
  .form-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--color-gray-200), transparent);
  }
  
  /* Header Styles */
  .form-section__badge {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-2);
    background-color: var(--color-secondary);
    color: var(--color-white);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    padding: var(--spacing-2) var(--spacing-4);
    border-radius: var(--radius-full);
    margin-bottom: var(--spacing-6);
  }
  
  .form-section__badge-icon {
    flex-shrink: 0;
  }
  
  .form-section__title {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
    color: var(--color-gray-900);
    margin-bottom: var(--spacing-4);
  }
  
  .form-section__highlight {
    color: var(--color-primary);
    position: relative;
  }
  
  .form-section__highlight::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 0;
    right: 0;
    height: 3px;
    background-color: var(--color-accent);
    border-radius: var(--radius-sm);
    opacity: 0.3;
  }
  
  .form-section__subtitle {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-relaxed);
    color: var(--color-gray-600);
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Container Styles */
  .form-section__container {
    background-color: var(--color-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    overflow: hidden;
    border: 1px solid var(--color-gray-100);
  }
  
  .form-section__grid {
    align-items: stretch;
    min-height: 600px;
  }
  
  /* Benefits Side */
  .form-section__benefits {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: var(--color-white);
    padding: var(--spacing-8);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  
  .form-section__benefits-title {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--spacing-6);
    line-height: var(--line-height-tight);
  }
  
  .form-section__benefits-list {
    list-style: none;
    padding: 0;
    margin: 0 0 var(--spacing-8) 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-5);
  }
  
  .form-section__benefit {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-3);
  }
  
  .form-section__benefit-icon {
    flex-shrink: 0;
    background-color: rgba(255, 255, 255, 0.2);
    padding: var(--spacing-1);
    border-radius: var(--radius-md);
    margin-top: 2px;
  }
  
  .form-section__benefit div {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
  }
  
  .form-section__benefit strong {
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-base);
    line-height: var(--line-height-tight);
  }
  
  .form-section__benefit span {
    font-size: var(--font-size-sm);
    opacity: 0.9;
    line-height: var(--line-height-normal);
  }
  
  /* Social Proof */
  .form-section__social-proof {
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    padding-top: var(--spacing-6);
  }
  
  .form-section__stats {
    display: flex;
    gap: var(--spacing-6);
    margin-bottom: var(--spacing-4);
  }
  
  .form-section__stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  
  .form-section__stat-number {
    font-size: var(--font-size-2xl);
    font-weight: var(--font-weight-bold);
    line-height: var(--line-height-tight);
  }
  
  .form-section__stat-label {
    font-size: var(--font-size-xs);
    opacity: 0.9;
    line-height: var(--line-height-tight);
  }
  
  .form-section__guarantee {
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
    background-color: rgba(255, 255, 255, 0.1);
    padding: var(--spacing-3);
    border-radius: var(--radius-lg);
  }
  
  .form-section__guarantee-icon {
    flex-shrink: 0;
  }
  
  .form-section__guarantee div {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
  }
  
  .form-section__guarantee strong {
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-sm);
  }
  
  .form-section__guarantee span {
    font-size: var(--font-size-xs);
    opacity: 0.9;
  }
  
  /* Form Styles */
  .form-section__form-container {
    padding: var(--spacing-8);
  }
  
  .form-section__form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-5);
  }
  
  .form-section__field {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }
  
  .form-section__label {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-gray-700);
  }
  
  .form-section__input,
  .form-section__select {
    padding: var(--spacing-3) var(--spacing-4);
    border: 2px solid var(--color-gray-200);
    border-radius: var(--radius-lg);
    font-size: var(--font-size-base);
    font-family: inherit;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
    background-color: var(--color-white);
  }
  
  .form-section__input:focus,
  .form-section__select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }
  
  .form-section__input.error,
  .form-section__select.error {
    border-color: var(--color-error);
  }
  
  .form-section__input::placeholder {
    color: var(--color-gray-400);
  }
  
  /* Error and Help Text */
  .form-section__error {
    color: var(--color-error);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    display: none;
  }
  
  .form-section__error.show {
    display: block;
  }
  
  .form-section__help {
    color: var(--color-gray-500);
    font-size: var(--font-size-xs);
    line-height: var(--line-height-normal);
  }
  
  /* Privacy Checkbox */
  .form-section__privacy {
    margin-top: var(--spacing-2);
  }
  
  .form-section__checkbox-container {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-3);
    cursor: pointer;
    line-height: var(--line-height-normal);
  }
  
  .form-section__checkbox {
    position: absolute;
    opacity: 0;
    cursor: pointer;
  }
  
  .form-section__checkmark {
    position: relative;
    width: 20px;
    height: 20px;
    background-color: var(--color-white);
    border: 2px solid var(--color-gray-300);
    border-radius: var(--radius-sm);
    flex-shrink: 0;
    margin-top: 2px;
    transition: all var(--transition-fast);
  }
  
  .form-section__checkbox:checked + .form-section__checkmark {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
  }
  
  .form-section__checkbox:checked + .form-section__checkmark::after {
    content: '';
    position: absolute;
    left: 6px;
    top: 2px;
    width: 6px;
    height: 10px;
    border: solid var(--color-white);
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }
  
  .form-section__checkbox-text {
    font-size: var(--font-size-sm);
    color: var(--color-gray-600);
    line-height: var(--line-height-normal);
  }
  
  .form-section__link {
    color: var(--color-primary);
    text-decoration: underline;
    font-weight: var(--font-weight-medium);
  }
  
  .form-section__link:hover {
    text-decoration: none;
  }
  
  /* Submit Button */
  .form-section__submit {
    margin-top: var(--spacing-2);
    position: relative;
    overflow: hidden;
  }
  
  .form-section__submit:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }
  
  .form-section__submit-text,
  .form-section__submit-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
    transition: opacity var(--transition-fast);
  }
  
  .form-section__submit-icon,
  .form-section__spinner {
    flex-shrink: 0;
  }
  
  .form-section__spinner {
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* Security Note */
  .form-section__security {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-2);
    color: var(--color-gray-500);
    font-size: var(--font-size-xs);
    margin-top: var(--spacing-4);
  }
  
  .form-section__security-icon {
    flex-shrink: 0;
  }
  
  /* Responsive Design */
  @media (max-width: 1023px) {
    .form-section__grid {
      grid-template-columns: 1fr;
      min-height: auto;
    }
    
    .form-section__benefits {
      order: 2;
      padding: var(--spacing-6);
    }
    
    .form-section__form-container {
      order: 1;
      padding: var(--spacing-6);
    }
    
    .form-section__stats {
      justify-content: center;
    }
  }
  
  @media (max-width: 640px) {
    .form-section__title {
      font-size: var(--font-size-2xl);
    }
    
    .form-section__subtitle {
      font-size: var(--font-size-base);
    }
    
    .form-section__benefits,
    .form-section__form-container {
      padding: var(--spacing-4);
    }
    
    .form-section__stats {
      flex-direction: column;
      gap: var(--spacing-3);
    }
    
    .form-section__guarantee {
      flex-direction: column;
      text-align: center;
    }
  }
</style>

<script>
  // Form validation and submission handling
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('leadForm') as HTMLFormElement;
    const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;
    const submitText = submitBtn.querySelector('.form-section__submit-text') as HTMLElement;
    const submitLoading = submitBtn.querySelector('.form-section__submit-loading') as HTMLElement;
    
    // Phone number formatting
    const celularInput = document.getElementById('celular') as HTMLInputElement;
    if (celularInput) {
      celularInput.addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        
        if (value.length >= 11) {
          value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        } else if (value.length >= 7) {
          value = value.replace(/(\d{2})(\d{4})(\d+)/, '($1) $2-$3');
        } else if (value.length >= 3) {
          value = value.replace(/(\d{2})(\d+)/, '($1) $2');
        }
        
        this.value = value;
      });
    }
    
    // Real-time email validation
    const emailInput = document.getElementById('email') as HTMLInputElement;
    if (emailInput) {
      emailInput.addEventListener('blur', function() {
        validateEmail(this);
      });
    }
    
    // Form submission
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Validate all fields
        const isValid = validateForm();
        
        if (!isValid) {
          return;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        submitText.style.display = 'none';
        submitLoading.style.display = 'flex';
        
        try {
          // Track form submission
          if (typeof (globalThis as any).gtag !== 'undefined') {
            (globalThis as any).gtag('event', 'form_submit', {
              event_category: 'Lead Generation',
              event_label: 'Contact Form',
              value: 1
            });
          }
          
          // Submit form to Formspree
          const formData = new FormData(form);
          const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
              'Accept': 'application/json'
            }
          });
          
          if (response.ok) {
            // Success - redirect to thank you page
            window.location.href = '/obrigado';
          } else {
            throw new Error('Form submission failed');
          }
          
        } catch (error) {
          // Error handling
          console.error('Form submission error:', error);
          alert('Ops! Houve um erro ao enviar o formulário. Tente novamente ou entre em contato via WhatsApp.');
          
          // Reset button state
          submitBtn.disabled = false;
          submitText.style.display = 'flex';
          submitLoading.style.display = 'none';
        }
      });
    }
    
    function validateForm(): boolean {
      const fields = [
        { id: 'nome', required: true, minLength: 2 },
        { id: 'email', required: true, type: 'email' },
        { id: 'celular', required: true, pattern: /^\(\d{2}\)\s\d{4,5}-\d{4}$/ },
        { id: 'privacy', required: true, type: 'checkbox' }
      ];
      
      let isValid = true;
      
      fields.forEach(field => {
        const input = document.getElementById(field.id) as HTMLInputElement;
        const errorEl = document.getElementById(`${field.id}-error`) as HTMLElement;
        
        if (!input) return;
        
        let hasError = false;
        let errorMessage = '';
        
        // Check required fields
        if (field.required && !input.value.trim()) {
          hasError = true;
          errorMessage = 'Este campo é obrigatório';
        }
        
        // Check email format
        else if (field.type === 'email' && input.value) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(input.value)) {
            hasError = true;
            errorMessage = 'Digite um email válido';
          }
        }
        
        // Check phone pattern
        else if (field.pattern && input.value && !field.pattern.test(input.value)) {
          hasError = true;
          errorMessage = 'Digite um número de celular válido';
        }
        
        // Check minimum length
        else if (field.minLength && input.value.length < field.minLength) {
          hasError = true;
          errorMessage = `Mínimo de ${field.minLength} caracteres`;
        }
        
        // Check checkbox
        else if (field.type === 'checkbox' && !input.checked) {
          hasError = true;
          errorMessage = 'É necessário concordar com os termos';
        }
        
        // Show/hide error
        if (hasError) {
          input.classList.add('error');
          if (errorEl) {
            errorEl.textContent = errorMessage;
            errorEl.classList.add('show');
          }
          isValid = false;
        } else {
          input.classList.remove('error');
          if (errorEl) {
            errorEl.classList.remove('show');
          }
        }
      });
      
      return isValid;
    }
    
    function validateEmail(input: HTMLInputElement): boolean {
      const errorEl = document.getElementById('email-error') as HTMLElement;
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (input.value && !emailRegex.test(input.value)) {
        input.classList.add('error');
        if (errorEl) {
          errorEl.textContent = 'Digite um email válido';
          errorEl.classList.add('show');
        }
        return false;
      } else {
        input.classList.remove('error');
        if (errorEl) {
          errorEl.classList.remove('show');
        }
        return true;
      }
    }
  });
</script>
